<% include layout/header.ejs %>
    <div class="container-fluid px-0">
		<div class="row justify-content-md-center m-0">
			<div class="col-4 p-3 mt-3 rounded form-background">
		        <div class="row mx-0" id="signinBlock">
		            <div class="col px-0">
						<form  method="post" id="signinForm" action="/signin">
						  <div class="form-group">
						    <label for="email" class="transText">Email</label>
						    <input type="email" class="form-control" name="email" id="signinEmail">
							<div class="valid-feedback">
						        Looks good!
						     </div>
							 <div class="invalid-feedback">
					            Wrong email!
					         </div>
						  </div>
						  <div class="form-group">
						    <label for="password" class="transText">Password</label>
						    <input type="password" class="form-control" name="password" id="signinPassword">
							<div class="valid-feedback" id="signinPasswordValid">
						        Looks good!
						     </div>
							 <div class="invalid-feedback">
							   Wrong password!
							</div>
						  </div>
						</form>
						<button type="button" class="btn btn-secondary shadow-sm float-left" onclick="switchToSignUp()">Sign up</button>
						<button type="button" class="btn btn-success shadow-sm float-right" onclick="signin()">Sign in</button>
		            </div>
		        </div>
				<div class="row mx-0" id="signupBlock" style="display:none;">
		            <div class="col px-0">
						<form  method="post" id="signupForm" action="/signup">
						  <div class="form-group">
						    <label for="email" class="transText">Email</label>
						    <input type="email" class="form-control" name="email" id="signupEmail">
							<div class="valid-feedback">
						        Looks good!
						     </div>
							 <div class="invalid-feedback">
					            Bad email. An example of a good email: 'email@mail.com'
					         </div>
						  </div>
						  <div class="form-group">
							    <label for="password" class="transText">Password</label>
							    <input type="password" class="form-control" name="password" aria-describedby="passwordHelpBlock" id="signupPassword">
								<small id="passwordHelpBlock" class="form-text text-muted">
								  	Your password must be 8-20 characters long, contain letters and numbers, and must not contain spaces or special characters.
								</small>
								<div class="valid-feedback">
							        Good password!
							     </div>
								 <div class="invalid-feedback">
						            Bad password!
						         </div>
						  </div>
						  <div class="form-group">
						    <label for="repeatPassword" class="transText">Repeat password</label>
						    <input type="password" class="form-control" name="repeatPassword" id="signupRepeatPassword">
							<div class="valid-feedback">
						        Passwords coincide!
						     </div>
							 <div class="invalid-feedback">
					            Passwords do not coincide!
					         </div>
						  </div>
						</form>
						<button type="button" class="btn btn-secondary shadow-sm float-left" onclick="switchToSignIn()">Sign in</button>
						<button type="button" class="btn btn-primary shadow-sm float-right" onclick="signup()">Sign up</button>
		            </div>
		        </div>
			</div>
		</div>
    </div>
	<script>
		function signin(){
			let email = $('input#signinEmail').val();
			let password = $('input#signinPassword').val();
			let emailValid = false,
				passwordValid =  false;
			var reg = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
			if(reg.test(email)){
				emailValid = true;
			}else{
				emailValid = false;
			}
			reg = /^[A-Za-z0-9_.]+$/;
			if(password.split(" ").join("").length == 0 ||
			   password.length < 8 ||
			   password.length > 20 ||
			   !reg.test(password)){
				passwordValid = false;
			}else{
				passwordValid = true;
			}
			if(emailValid && passwordValid){
				$('#signinForm').submit();
			}else{
				let emailInput = $("#signinEmail");
				let passwordInput = $("#signinPassword");
				validationShow(emailInput, emailValid);
				validationShow(passwordInput, passwordValid);
			}
		}
		function signup(){
			let email = $('input#signupEmail').val();
			let password = $('input#signupPassword').val();
			let repeatPassword = $('input#signupRepeatPassword').val();
			let emailValid = false,
			    passwordValid = false,
			    repeatPasswordValid = false;
			var reg = /^[A-Za-z0-9_.]+$/;
			if(password.split(" ").join("").length == 0 ||
			   password.length < 8 ||
			   password.length > 20 ||
			   !reg.test(password)){
				passwordValid = false;
			}else{
				passwordValid = true;
			}
			if(password == repeatPassword && repeatPassword.length != 0){
				repeatPasswordValid = true;
			}else{
				repeatPasswordValid = false;
			}
			reg = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
			if(reg.test(email)){
				emailValid = true;
			}else{
				emailValid = false;
			}
			if(emailValid && passwordValid && repeatPasswordValid){
				$('#signupForm').submit();
			}else{
				let emailInput = $("#signupEmail");
				let passwordInput = $("#signupPassword");
				let repeatPasswordInput = $("#signupRepeatPassword");
				validationShow(emailInput, emailValid);
				validationShow(passwordInput, passwordValid);
				validationShow(repeatPasswordInput, repeatPasswordValid);
			}
		}
		function switchToSignUp(){
			$('#signinBlock').attr('style', 'display:none;');
			$('#signupBlock').attr('style', 'display:block;');
			$("#signinEmail").val("");
			$("#signinPassword").val("");
			validationClassDelete([$("#signinEmail"), $("#signinPassword")]);
		}
		function switchToSignIn(){
			$('#signupBlock').attr('style', 'display:none;');
			$('#signinBlock').attr('style', 'display:block;');
			$("#signupEmail").val("");
			$("#signupPassword").val("");
			$("#signupRepeatPassword").val("");
			validationClassDelete([$("#signupEmail"), $("#signupPassword"), $("#signupRepeatPassword")]);
		}
		function validationShow(element, valid){
			if(valid){
				element.removeClass("is-invalid");
				element.addClass("is-valid");
			}else{
				element.removeClass("is-valid");
				element.addClass("is-invalid");
			}
		}
		function validationClassDelete(elements){
			elements.forEach(function(element) {
				element.removeClass("is-invalid");
				element.removeClass("is-valid");
			});
		}
	</script>
<% include layout/footer.ejs %>
